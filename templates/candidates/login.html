<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BMA Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen" x-data="{tab:'candidate'}">

<div class="bg-white rounded-2xl shadow-xl w-full max-w-md p-8">

  <div class="flex flex-col items-center mb-6">
    <img src="/static/images/BMA-Logo-Approved-3.png" alt="BMA Logo" class="w-24 h-24 mb-3">
  </div>

  <h1 class="text-2xl font-bold text-orange-500 text-center mb-6">Login</h1>

<!-- Tabs -->
<div class="flex mb-6 border-b">
  <button id="tabCandidate" class="flex-1 py-2 text-center text-green-600 border-b-4 border-green-600 font-semibold">Candidate</button>
  <button id="tabEmployee" class="flex-1 py-2 text-center text-gray-600 hover:text-green-600 transition">Employee</button>
</div>

<!-- Candidate Form -->
<!--<form class="form-section">-->
<form id="candidateForm" class="flex flex-col gap-5">

  <!-- Email Field -->
  <div class="relative">
    <label class="mb-1 font-medium text-gray-700">Email</label>
    <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">email</span>
    <input type="email" name="email" required
           class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none shadow-sm transition duration-200"
           placeholder="Enter your email">
  </div>

  <!-- Password Field -->
  <div class="relative">
    <label class="mb-1 font-medium text-gray-700">Password</label>
    <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">lock</span>
    <input type="password" name="password" required
           class="w-full pl-10 pr-10 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none shadow-sm transition duration-200"
           placeholder="Enter your password" id="candidatePassword">
    <span class="material-icons absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 cursor-pointer"
          onclick="togglePassword('candidatePassword')">visibility</span>
  </div>

  <!-- Forgot Password & Help -->
  <div class="flex justify-between text-sm mt-1">
    <a href="{{ url_for('candidateForgotPassword') }}" class="text-green-600 hover:underline">Forgot Password?</a>
    <a href="{{ url_for('candidateHelp') }}" class="text-gray-500 hover:text-green-600">Need Help?</a>
  </div>

  <!-- Login Button -->
  <button type="submit"
          class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-xl font-semibold hover:from-green-700 hover:to-green-800 transition-shadow duration-300 shadow-md hover:shadow-lg mt-4">
    Login as Candidate
  </button>

  <!-- Signup Link -->
  <p class="text-sm text-gray-500 text-center mt-4">
    Don’t have an account? 
    <a href="{{url_for('signup')}}" class="text-green-600 hover:underline font-medium">Signup</a>
  </p>

</form>

  <!-- Employee Form -->
<!--<form class="form-section" style="display:none;">-->
  <form id="employeeForm" class="form-section" style="display:none;">
  <!-- Email Field -->
  <div class="relative">
    <label class="mb-1 font-medium text-gray-700">Email</label>
    <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">email</span>
    <input type="email" name="email" required
           class="w-full pl-10 pr-3 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none shadow-sm transition duration-200"
           placeholder="Enter your email">
  </div>

  <!-- Password Field -->
  <div class="relative">
    <label class="mb-1 font-medium text-gray-700">Password</label>
    <span class="material-icons absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">lock</span>
    <input type="password" name="password" required
           class="w-full pl-10 pr-10 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-green-500 focus:border-green-500 outline-none shadow-sm transition duration-200"
           placeholder="Enter your password" id="employeePassword">
    <span class="material-icons absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 cursor-pointer"
          onclick="togglePassword('employeePassword')">visibility</span>
  </div>

  <!-- Forgot Password & Help -->
  <div class="flex justify-between text-sm mt-1">
    <a href="{{url_for('internalEmpForgot')}}" class="text-green-600 hover:underline">Forgot Password?</a>
    <a href="{{url_for('candidateHelp')}}" class="text-gray-500 hover:text-green-600">Need Help?</a>
  </div>

  <!-- Login Button -->
  <button type="submit"
          class="w-full bg-gradient-to-r from-green-600 to-green-700 text-white py-3 rounded-xl font-semibold hover:from-green-700 hover:to-green-800 transition-shadow duration-300 shadow-md hover:shadow-lg mt-4">
    Login as Employee
  </button>

  <!-- Signup Link -->
  <p class="text-sm text-gray-500 text-center mt-4">
    Don’t have an account? 
    <a href="{{url_for('signup')}}" class="text-green-600 hover:underline font-medium">Signup</a>
  </p>

</form>

</div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
function togglePassword(id){
  const input = document.getElementById(id);
  input.type = input.type === 'password' ? 'text' : 'password';
}
</script>

<script>
const tabCandidate = document.getElementById('tabCandidate');
const tabEmployee = document.getElementById('tabEmployee');
const candidateForm = document.getElementById('candidateForm');
const employeeForm = document.getElementById('employeeForm');

// Tab switching
tabCandidate.addEventListener('click', ()=>{
  candidateForm.style.display='block';
  employeeForm.style.display='none';
  tabCandidate.classList.add('text-green-600','border-b-4','font-semibold');
  tabEmployee.classList.remove('text-green-600','border-b-4','font-semibold');
});

tabEmployee.addEventListener('click', ()=>{
  candidateForm.style.display='none';
  employeeForm.style.display='block';
  tabEmployee.classList.add('text-green-600','border-b-4','font-semibold');
  tabCandidate.classList.remove('text-green-600','border-b-4','font-semibold');
});

// Candidate login
candidateForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const email = candidateForm.email.value.trim();
  const password = candidateForm.password.value.trim();
  if(!email || !password) return alert('Email and password required');

  try{
    const res = await fetch('https://jellyfish-app-z83s2.ondigitalocean.app/api/candidate/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({email,password,user_type:'external'})
    });
    const data = await res.json();
    if(res.ok){
        sessionStorage.setItem('applicant_id', data.user_id);
        sessionStorage.setItem('access_token', data.access_token);
        Swal.fire({
        icon:'success',
        title:'Login Success',
        text:'Redirecting to dashboard...',
        timer:1500,
        showConfirmButton:false
    });
    setTimeout(() => window.location.href = "{{ url_for('candidateDashboard') }}", 1600);
    }
    else alert(data.message || 'Login failed');
  }catch(err){ console.error(err); alert('Network error'); }
});

// Employee login
employeeForm.addEventListener('submit', async e=>{
  e.preventDefault();
  const email = employeeForm.email.value.trim();
  const password = employeeForm.password.value.trim();
  if(!email || !password) return alert('Email and password required');

  try{
    const res = await fetch('https://jellyfish-app-z83s2.ondigitalocean.app/api/candidate/login',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({email,password,user_type:'internal'})
    });
    const data = await res.json();
    if(res.ok){
      sessionStorage.setItem('applicant_id', data.user_id);
      sessionStorage.setItem('access_token', data.access_token);
      Swal.fire({
        icon:'success',
        title:'Login Success',
        text:'Redirecting to dashboard...',
        timer:1500,
        showConfirmButton:false
    });
    setTimeout(() => window.location.href = "{{ url_for('employeeDashboard') }}", 1600);

    } else alert(data.message || 'Login failed');
  }catch(err){ console.error(err); alert('Network error'); }
});
</script>

</body>
</html>